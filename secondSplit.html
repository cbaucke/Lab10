<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lab 8 - E2E Testing</title>

  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="./styles/style.css">

  <!-- Favicon -->
  <link rel="icon" href="./styles/favicon.ico">
</head>

<body>
  <header>
    <h1>Journal Entries</h1>
    <img src="./styles/settings.svg" alt="settings" width=40 height=40>
  </header>

  <main class="double-column"></main>

  <entry-page></entry-page>

  <!-- journal-entry web component -->
  <script src="./components/journal-entry.js" type="module"></script>
  <script src="./components/entry-page.js" type="module"></script>

  <!-- Router Script -->
  <script src="./scripts/router.js" type="module"></script>

  <!-- Main Script -->
  <script src="./scripts/script.js" type="module"></script>

  <!-- Some polyfills to ensure we have promises. -->
  <script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
  <!-- Split SDK loaded via CDN. -->
  <script src="https://cdn.split.io/sdk/split-10.15.7.js"></script>
  <!-- Our custom script. -->
  <script type="text/javascript">
    (function() {
      let custID = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });

      var factory = splitio({
        core: {
          authorizationKey: 'fotu86j59ku7c7i02q6dg2gfo6h45412ks65',
          key: custID
        }
      });

      var client = factory.client();
      client.on(client.Event.SDK_READY, function() {
        var treatment = client.getTreatment('dark_mode');

        if (treatment === 'on') {
          let all = document.querySelectorAll("*");
          for(let i = 0; i < all.length; i++){
            all[i].style.color = "#f2f2f7";
          }
          document.getElementsByTagName("body")[0].style.backgroundColor = "#48484a";
          document.getElementsByTagName("header")[0].style.backgroundColor = "#1c1c1e";
          let entries = document.querySelectorAll("journal-entry");
          console.log("Num entries: " + entries.length);
          for(let i = 0; i < entries.length; i++){
            entries[i].setAttribute("style", "color: #3d3d3d; background-color: #111111");
          }
        } else if (treatment === 'off') {
          let all = document.querySelectorAll("*");
          for(let i = 0; i < all.length; i++){
            all[i].style.color = "#3d3d3d";
          }
          document.getElementsByTagName("body")[0].style.backgroundColor = "#EFECCA";
          document.getElementsByTagName("header")[0].style.backgroundColor = "#D9D281";
          let entries = document.querySelectorAll("journal-entry");
          for(let i = 0; i < entries.length; i++){
            entries[i].setAttribute("style", "color: #3d3d3d; background-color: #111111");
          }
        } else {
          // Insert code for control treatment
        }

        client.destroy().then(function() {
          // Your data is successfully flushed.
        });
      });
    })();
  </script>
</body>

</html>
